!function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(2),r=n(3),a=n(1),l=n(5);e.widthButton=a.board.width/2-10,e.yButton1=a.board.height-200+5,e.yButton2=a.board.height-60+5,e.canvas=document.getElementById("gameboard"),e.context=e.canvas.getContext("2d");var s=new o.DrawElements,i=new WebSocket("ws://localhost:3000"),u=function(t){i.readyState?i.send(t):setTimeout(function(){u(t)},100)};u(JSON.stringify({operation:"game_size",username:document.getElementById("username").innerText})),i.onmessage=function(t){var n=JSON.parse(t.data);"game_size"==n.operation&&(console.log("----------------------"),console.log(n),e.canvas.style.height=n.height+"px",e.canvas.style.width=n.width+"px;",e.canvas.style.position="absolute",e.canvas.style.marginTop="10px",e.canvas.style.marginLeft="auto",e.canvas.style.marginRight="auto")},e.answer=[],e.dialog=new l.Dialog,e.dialog.fillTextButton(),e.lineHeight=20,e.marginLeft=5,e.marginTop=40,s.drawBoard(e.canvas,a.board.url),s.drawCustomer(e.canvas,a.customer.url,250,300),s.drawButton(e.canvas,5,e.yButton1,e.widthButton,90),s.drawButton(e.canvas,5,e.yButton1+100,e.widthButton,90),s.drawButton(e.canvas,e.widthButton+15,e.yButton1,e.widthButton,90),s.drawButton(e.canvas,e.widthButton+15,e.yButton1+100,e.widthButton,90),s.textIn(e.context,a.buttonText.button1,e.marginLeft,e.yButton1+e.lineHeight,e.widthButton,e.lineHeight,"center"),s.textIn(e.context,a.buttonText.button2,e.marginLeft+e.widthButton+15,e.yButton1+e.lineHeight,e.widthButton,e.lineHeight,"center"),s.textIn(e.context,a.buttonText.button3,e.marginLeft,e.yButton1+90+25,e.widthButton,e.lineHeight,"center"),s.textIn(e.context,a.buttonText.button4,e.marginLeft+e.widthButton+15,e.yButton1+90+25,e.widthButton,e.lineHeight,"center"),r.mouseCanvas();var g=new XMLHttpRequest;g.open("GET","./.xml",!1),g.open("GET","./DialogList/step3.xml",!1),g.send(),console.log("START "+g.responseXML.getElementsByTagName("seller")[0].getElementsByTagName("phrase")[1].getElementsByTagName("step")[0].innerHTML)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.board={width:1080,height:720,url:"./src/back.jpg"},e.customer={width:250,height:340,url:"./src/customer.png"},e.mouse={x:0,y:0},e.buttonText={button1:null,button2:null,button3:null,button4:null},e.ask={specific:[],statisfactory:[],negative:[]},e.answerAsk={positiv:[],statisfactory:[],negative:[]},e.answerStat={positiv:[],statisfactory:[],negative:[]}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(){this.flag=!0}return t.prototype.drawBoard=function(t,e,n,o){var r=t.getContext("2d"),a=new Image;a.src=e,1==this.flag?window.addEventListener("load",function(){r.drawImage(a,0,0,t.width,t.height),r.fillStyle="rgba(0,0,0,0.7)",r.fillRect(0,t.height-200,t.width,200)}):(r.drawImage(a,0,0,t.width,t.height),r.fillStyle="rgba(0,0,0,0.7)",r.fillRect(0,t.height-200,t.width,200))},t.prototype.drawCustomer=function(t,e,n,o){var r=t.getContext("2d"),a=new Image;a.src=e,1==this.flag?window.addEventListener("load",function(){r.drawImage(a,t.width-n,t.height-o-200,n,o)}):r.drawImage(a,t.width-n,t.height-o-200,n,o)},t.prototype.drawButton=function(t,e,n,o,r){var a=t.getContext("2d");1==this.flag?window.addEventListener("load",function(){a.fillStyle="rgba(255,255,255,0.5)",a.fillRect(e,n,o,r)}):(a.fillStyle="rgba(255,255,255,0.5)",a.fillRect(e,n,o,r))},t.prototype.textIn=function(t,e,n,o,r,a,l){var s=n+5;if(1==this.flag)window.addEventListener("load",function(){t.font="16pt Calibri";for(var i=e.split(" "),u=i.length,g="",c=0;c<u;c++){var m=g+i[c]+" ";if(t.measureText(m).width>r){if("center"==l){var d=r/2-t.measureText(g).width/2;n=s+d}t.fillStyle="Black",t.fillText(g,n,o),g=i[c]+" ",o+=a}else g=m}if("center"==l){d=r/2-t.measureText(g).width/2;n=s+d}t.fillStyle="Black",t.fillText(g,n,o)});else{t.font="16pt Calibri";for(var i=e.split(" "),u=i.length,g="",c=0;c<u;c++){var m=g+i[c]+" ";if(t.measureText(m).width>r){if("center"==l){var d=r/2-t.measureText(g).width/2;n=s+d}t.fillStyle="Black",t.fillText(g,n,o),g=i[c]+" ",o+=a}else g=m}if("center"==l){d=r/2-t.measureText(g).width/2;n=s+d}t.fillStyle="Black",t.fillText(g,n,o)}},t}();e.DrawElements=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),r=n(2),a=n(0),l=n(4);e.countPlayer=0;var s=new r.DrawElements;function i(t,e,n,r,l){var i=t.getContext("2d");new Image;i.clearRect(e,n,r,l),s.flag=!1,s.drawBoard(t,o.board.url),s.drawCustomer(t,o.customer.url,250,300),s.drawButton(t,5,a.yButton1,a.widthButton,90),s.drawButton(t,a.widthButton+15,a.yButton1,a.widthButton,90),s.drawButton(t,5,a.yButton1+100,a.widthButton,90),s.drawButton(t,a.widthButton+15,a.yButton1+100,a.widthButton,90),s.textIn(a.context,o.buttonText.button1,a.marginLeft,a.yButton1+a.lineHeight,a.widthButton,a.lineHeight,"center"),s.textIn(a.context,o.buttonText.button2,a.marginLeft+a.widthButton+15,a.yButton1+a.lineHeight,a.widthButton,a.lineHeight,"center"),s.textIn(a.context,o.buttonText.button3,a.marginLeft,a.yButton1+90+25,a.widthButton,a.lineHeight,"center"),s.textIn(a.context,o.buttonText.button4,a.marginLeft+a.widthButton+15,a.yButton1+90+25,a.widthButton,a.lineHeight,"center")}e.max=1,e.min=0,e.textCustomer="",e.random=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},e.mouseCanvas=function(){a.canvas.addEventListener("mousedown",function(t){o.mouse.x=null==t.offsetX?t.layerX:t.offsetX,o.mouse.y=null==t.offsetY?t.layerY:t.offsetY,console.log("MOUSE"),console.log(o.mouse.x+" "+o.mouse.y+" !!!"),0==l.endOfGame()&&(o.mouse.x>5&&o.mouse.x<a.widthButton+5&&o.mouse.y>a.yButton1&&o.mouse.y<a.yButton1+90&&(a.dialog.check(0),l.checkGameProcess(),a.dialog.fillTextButton(a.dialog.linkAnswerSeller),i(a.canvas,5,a.yButton1,a.widthButton,90)),o.mouse.x>a.widthButton+15&&o.mouse.x<o.board.width-5&&o.mouse.y>a.yButton1&&o.mouse.y<a.yButton1+90&&(a.dialog.check(1),l.checkGameProcess(),a.dialog.fillTextButton(a.dialog.linkAnswerSeller),i(a.canvas,5,a.yButton1,a.widthButton,90)),o.mouse.x>5&&o.mouse.x<a.widthButton+5&&o.mouse.y>a.yButton1+105&&o.mouse.y<o.board.height-5&&(a.dialog.check(2),l.checkGameProcess(),a.dialog.fillTextButton(a.dialog.linkAnswerSeller),i(a.canvas,5,a.yButton1,a.widthButton,90)),o.mouse.x>a.widthButton+15&&o.mouse.x<o.board.width-5&&o.mouse.y>a.yButton1+105&&o.mouse.y<o.board.height-5&&(a.dialog.check(3),l.checkGameProcess(),a.dialog.fillTextButton(a.dialog.linkAnswerSeller),i(a.canvas,5,a.yButton1,a.widthButton,90))),l.checkGameProcess()})}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),r=n(2),a=n(0);e.characterWindow=document.getElementById("characterWindow");var l=document.getElementById("text_customer");e.characterWindow.style.marginTop="10px",e.characterWindow.innerHTML="Счёт игрока:   0",e.characterWindow.style.border="0px";new r.DrawElements;var s=!1;e.checkGameProcess=function(){e.characterWindow.innerHTML="Счёт игрока:   "+a.dialog.countPlayer,l.innerText=a.dialog.textCustomer,(a.dialog.countPlayer<0||1==a.dialog.end)&&(function(){a.context.fillStyle="rgba(0,0,0)",a.context.clearRect(0,0,o.board.width,o.board.height),a.context.fillRect(0,0,o.board.width,o.board.height);var t="Клиент ушёл, вы проиграли";a.context.font="32pt Calibri",a.context.fillStyle="white",a.context.fillText(t,o.board.width/2-a.context.measureText(t).width/2,o.board.height/2),s=!0}(),console.log("       GAME OVER")),1==s&&(e.characterWindow.innerHTML="Счёт игрока:")},e.endOfGame=function(){return 1==s}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(6),r=n(3),a=n(1),l=function(){function t(){this.answer=[],this.gameStep=1,this.linkStep=1,this.textCustomer="",this.linkAnswerCustomer=[],this.linkAnswerSeller=[],this.countPlayer=0,this.points=[],this.transition=[],this.end=!1}return t.prototype.fillTextButton=function(t){if(0==this.end){console.log("       this.end    "+this.end);var e=0;null==t&&(t=o.firstRandom()),o.getStep(this.gameStep);var n=o.getPhraseSeller(t),l=o.getTextSeller(n);this.points=o.getPointsPhrase(n),this.linkAnswerCustomer=o.getLinkAnswerCustomer(n);var s=r.random(0,3);for(a.buttonText.button1=l[s],this.answer[0]=s,s=r.random(0,3),a.buttonText.button2=l[s];a.buttonText.button2==a.buttonText.button1;)s=r.random(0,3),a.buttonText.button2=l[s];for(this.answer[1]=s,s=r.random(0,3),a.buttonText.button3=l[s];a.buttonText.button3==a.buttonText.button1||a.buttonText.button3==a.buttonText.button2;)s=r.random(0,3),a.buttonText.button3=l[s];for(this.answer[2]=s,s=r.random(0,3),a.buttonText.button4=l[s];a.buttonText.button4==a.buttonText.button1||a.buttonText.button4==a.buttonText.button2||a.buttonText.button4==a.buttonText.button3;)if(s=r.random(0,3),a.buttonText.button4=l[s],e+=1,console.log("       i "+e),e>5e3){alert("Ошибка");break}e=0,this.answer[3]=s,console.log("+++ "+this.answer)}},t.prototype.check=function(t){var e;0==this.answer[t]&&(this.countPlayer+=this.points[0],o.checkStepPhrase(0),e=o.getAnswerCustomer(this.linkAnswerCustomer[0]),console.log(e),this.textCustomer=o.getTextCustomer(e),this.gameStep=o.getNextStep(e),this.linkAnswerSeller=o.getLinkAnswerSeller(e)),1==this.answer[t]&&(this.countPlayer+=this.points[1],o.checkStepPhrase(1),e=o.getAnswerCustomer(this.linkAnswerCustomer[1]),console.log(e),this.textCustomer=o.getTextCustomer(e),this.gameStep=o.getNextStep(e),this.linkAnswerSeller=o.getLinkAnswerSeller(e)),2==this.answer[t]&&(this.countPlayer+=this.points[2],o.checkStepPhrase(2),e=o.getAnswerCustomer(this.linkAnswerCustomer[2]),console.log(e),this.textCustomer=o.getTextCustomer(e),this.gameStep=o.getNextStep(e),this.linkAnswerSeller=o.getLinkAnswerSeller(e)),3==this.answer[t]&&(this.countPlayer+=this.points[3],o.checkStepPhrase(3),e=o.getAnswerCustomer(this.linkAnswerCustomer[3]),console.log(e),this.textCustomer=o.getTextCustomer(e),this.gameStep=o.getNextStep(e),this.linkAnswerSeller=o.getLinkAnswerSeller(e)),console.log("==== "+t+" ===== "+this.textCustomer)},t}();e.Dialog=l},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(3),r=n(0),a=new XMLHttpRequest;e.getStep=function(t){console.log("getStep start"),100!=t&&(a.open("GET","./DialogList/step"+t+".xml",!1),a.send(),console.log("   gameStep "+t)),console.log("getStep end "),console.log(" ")},e.getPhraseSeller=function(t){console.log("getPhraseSeller start");for(var e=a.responseXML.getElementsByTagName("seller")[0].children,n=[],o=0;o<4;o++)for(var r=0;r<e.length;r++)Number(e[r].id)==t[o]&&(n[o]=e[r]);return console.log(n),console.log("getPhraseSeller end "),console.log(" "),n},e.getPointsPhrase=function(t){console.log("getPointsPhrase start");for(var e=[],n=0;n<t.length;n++)e[n]=Number(t[n].getElementsByTagName("point")[0].innerHTML);return console.log("   points: "+e),console.log("getPointsPhrase end "),console.log(" "),e},e.getTextSeller=function(t){console.log("getTextSeller start");for(var e=[],n=0;n<t.length;n++)e[n]=t[n].getElementsByTagName("text")[0].innerHTML;return console.log("getTextSeller end "),console.log(" "),e},e.getLinkAnswerCustomer=function(t){var e;console.log("getLinkAnswerCustomer start");for(var n=[],a=0;a<t.length;a++)0!=t[a].getElementsByTagName("step").length&&(100!=Number(t[a].getElementsByTagName("step")[0].innerHTML)?r.dialog.transition[a]=Number(t[a].getElementsByTagName("step")[0].innerHTML):r.dialog.transition[a]=null),e=t[a].getElementsByTagName("next")[0],n[a]=Number(e.children[o.random(0,e.children.length-1)].innerHTML);return console.log("   "+n+" dialog.transition "+r.dialog.transition),console.log("getLinkAnswerCustomer end "),console.log(" "),n},e.getAnswerCustomer=function(t){console.log("getAnswerCustomer start");for(var e,n=a.responseXML.getElementsByTagName("customer")[0].children,o=0;o<n.length;o++)Number(n[o].id)==t&&(e=n[o]);return console.log("getLinkAnswerCustomer end "),console.log(" "),e},e.getTextCustomer=function(t){return t.getElementsByTagName("text")[0].innerHTML},e.getNextStep=function(t){var e;return console.log("getNextStep start"),0==Number(t.getElementsByTagName("step")[0].innerHTML)?(e=r.dialog.gameStep+1,console.log("   "+e)):(e=Number(t.getElementsByTagName("step")[0].innerHTML),console.log("   "+e)),console.log("STEP "+t.getElementsByTagName("step")[0].innerHTML),100==Number(t.getElementsByTagName("step")[0].innerHTML)?(console.log("           end"),r.dialog.end=!0,null):(console.log("getNextStep end "),console.log(" "),e)},e.getLinkAnswerSeller=function(t){console.log("getLinkAnswerSeller start");var e=[];if(1==r.dialog.end)return null;for(e[0]=Number(t.getElementsByTagName("next")[0].getElementsByTagName("correct")[o.random(0,t.getElementsByTagName("next")[0].getElementsByTagName("correct").length-1)].innerHTML),e[1]=Number(t.getElementsByTagName("next")[0].getElementsByTagName("statisfaction")[o.random(0,t.getElementsByTagName("next")[0].getElementsByTagName("statisfaction").length-1)].innerHTML),e[2]=Number(t.getElementsByTagName("next")[0].getElementsByTagName("statisfaction")[o.random(0,t.getElementsByTagName("next")[0].getElementsByTagName("statisfaction").length-1)].innerHTML);e[2]==e[1];)e[2]=Number(t.getElementsByTagName("next")[0].getElementsByTagName("statisfaction")[o.random(0,t.getElementsByTagName("next")[0].getElementsByTagName("statisfaction").length-1)].innerHTML);return e[3]=Number(t.getElementsByTagName("next")[0].getElementsByTagName("negative")[o.random(0,t.getElementsByTagName("next")[0].getElementsByTagName("negative").length-1)].innerHTML),console.log("   link: "+e),console.log("getLinkAnswerSeller end "),console.log(" "),console.log(" "),console.log(" "),console.log(" "),console.log(" "),console.log(" "),e},e.firstRandom=function(){console.log("firstRandom start"),a.open("GET","./DialogList/step1.xml",!1),a.send();for(var t=[],e=a.responseXML.getElementsByTagName("seller")[0].getElementsByTagName("phrase"),n=e[o.random(0,e.length-1)],r=n.getElementsByTagName("next")[0].children[0].tagName;"correct"!=r;)r=(n=e[o.random(0,e.length-1)]).getElementsByTagName("next")[0].children[0].tagName,t[0]=Number(n.id);for(t[0]=Number(n.id);"statisfaction"!=r;)r=(n=e[o.random(0,e.length-1)]).getElementsByTagName("next")[0].children[0].tagName,t[1]=Number(n.id);t[1]=Number(n.id),r=(n=e[o.random(0,e.length-1)]).getElementsByTagName("next")[0].children[0].tagName,console.log("type "+r+" "+("statisfaction"!=r&&t[1]==t[2]));for(var l=!0;1==l;)r=(n=e[o.random(0,e.length-1)]).getElementsByTagName("next")[0].children[0].tagName,t[2]=Number(n.id),console.log("ss "+t[1]+" "+t[2]+" "+r+" "+("statisfaction"!=r&&t[1]==t[2])),"statisfaction"==r&&t[1]!=t[2]&&(l=!1);for(r=(n=e[o.random(0,e.length-1)]).getElementsByTagName("next")[0].children[0].tagName;"negative"!=r;)r=(n=e[o.random(0,e.length-1)]).getElementsByTagName("next")[0].children[0].tagName,t[3]=Number(n.id);return t[3]=Number(n.id),console.log(t),console.log("firstRandom end"),console.log(" "),t},e.checkStepPhrase=function(t){console.log("checkStepPhrase start"),null!=r.dialog.transition[t]&&0!=r.dialog.transition[t]&&(a.open("GET","./DialogList/step"+r.dialog.transition[t]+".xml",!1),a.send(),r.dialog.gameStep=r.dialog.transition[t]),console.log("   checkStepPhrase "+r.dialog.transition[t]),console.log("checkStepPhrase end "),console.log(" ")}}]);
//# sourceMappingURL=main.js.map